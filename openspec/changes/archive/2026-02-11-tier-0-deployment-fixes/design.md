## Context

The tentacular CLI generates three categories of K8s/Docker artifacts during the build-deploy cycle:

1. **K8s Secret manifests** -- generated by `buildSecretFromYAML()` in `pkg/cli/deploy.go:215-248` from a local `.secrets.yaml` file. Currently unmarshals into `map[string]string`, which silently fails or errors when the YAML contains nested maps (e.g., `slack: { webhook_url: "..." }`). The engine's `loadSecretsFromDir()` expects JSON content per service key, so nested maps must be JSON-serialized.

2. **K8s Deployment manifests** -- generated by `GenerateK8sManifests()` in `pkg/builder/k8s.go:116-269`. The container spec at line 174 sets `image: %s` but omits `imagePullPolicy`, defaulting to `IfNotPresent`. When developers re-push a tag (common with `tentacular-engine:latest`), the cluster serves a stale cached image.

3. **Dockerfile** -- generated by `GenerateDockerfile()` in `pkg/builder/dockerfile.go:5-27`. The `deno cache` command at line 17 is `RUN ["deno", "cache", "engine/main.ts"]` but lacks `--no-lock`. The ENTRYPOINT at line 24 already has `--no-lock`. Without it, `deno cache` looks for a lock file that doesn't exist in the image, causing build failures.

All three are independent, single-site changes with no cross-cutting concerns. Existing tests in each package validate the current behavior and need new cases added.

## Goals / Non-Goals

**Goals:**

- Fix nested YAML secrets parsing so `buildSecretFromYAML()` handles `map[string]interface{}` with JSON serialization for non-string values
- Ensure generated K8s Deployments always pull the latest image
- Ensure `deno cache` in the generated Dockerfile doesn't fail looking for a nonexistent lock file
- Add test coverage for all three fixes
- Maintain backwards compatibility for flat string secrets

**Non-Goals:**

- Shared secrets pool (`$shared.` syntax) -- that's T2-7, a separate change
- Version labels in K8s manifests -- that's T1-6
- Restructuring the Dockerfile template or adding node dependency caching
- Changing the `buildSecretFromDir()` path (directory-based secrets already work correctly)

## Decisions

### D1: Type-switch approach for nested YAML values

Change `buildSecretFromYAML()` to unmarshal into `map[string]interface{}` and use a type switch:
- `string` values pass through as-is (backwards compatible)
- All other types (`map`, `slice`, `int`, etc.) get `json.Marshal`'d into a JSON string

**Why this over alternatives:**
- *Alternative: recursive flattening* (e.g., `slack.webhook_url` as a flat key) -- rejected because the engine's `loadSecretsFromDir()` expects one file per service with JSON content. Flattening would break the contract.
- *Alternative: always JSON-serialize* -- rejected because flat strings should remain readable in `kubectl get secret -o yaml` output. The type switch preserves human-readable values where possible.

**Implementation detail:** The `json.Marshal` call for nested values cannot realistically fail on data that came from `yaml.Unmarshal`, but the error should still be checked and propagated rather than silently swallowed with `_`.

### D2: imagePullPolicy placement in the Deployment template string

Insert `imagePullPolicy: Always` as a single line after `image: %s` (line 174) in the Deployment template within `GenerateK8sManifests()`. The indentation must match: 10 spaces (same level as `image:`, `ports:`, `securityContext:`).

**Why `Always` and not `Never` or omission:**
- The target deployment model uses a private registry with mutable tags (re-push on rebuild). `IfNotPresent` (the K8s default when omitted) causes stale image issues.
- `Always` is safe for both tagged and `latest` images and matches the expectation of rapid iteration during development.

### D3: Minimal --no-lock insertion in Dockerfile

Change line 17 of `dockerfile.go` from:
```
RUN ["deno", "cache", "engine/main.ts"]
```
to:
```
RUN ["deno", "cache", "--no-lock", "engine/main.ts"]
```

This is the minimal change. No signature or structural changes needed.

**Why --no-lock:** The engine image intentionally omits a deno.lock file. The ENTRYPOINT already uses `--no-lock`. The cache command must match or it fails looking for a lock file that was never created.

## Risks / Trade-offs

**`imagePullPolicy: Always` increases image pull frequency** -- Every pod restart will pull from the registry, adding network overhead and latency. This is acceptable for the current development-stage deployment model with a private registry on the same cluster network. If production deployments need `IfNotPresent` for tagged releases, that can be added as a `DeployOptions` field later.

**`json.Marshal` error handling in nested secrets** -- While `json.Marshal` on YAML-parsed data is unlikely to fail (no channels, functions, or circular references), the error path should still return a wrapped error rather than using `_`. This avoids silent data loss if an edge case arises.

**No migration needed** -- All three changes affect generated output only. Existing deployments continue to work. Redeploying with the fixed CLI produces correct manifests. No rollback concern.
